<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Video Splitter 30s</title>

  <!-- Wajib untuk aktifkan SharedArrayBuffer di browser -->
  <meta http-equiv="Cross-Origin-Opener-Policy" content="same-origin">
  <meta http-equiv="Cross-Origin-Embedder-Policy" content="require-corp">
</head>
<body>
  <h2>Video Splitter 30s</h2>
  <input type="file" id="uploader" accept="video/*">
  <button id="start">Mulai Potong</button>
  <div id="output"></div>

  <!-- Load ffmpeg.wasm versi UMD -->
  <script src="https://cdn.jsdelivr.net/npm/@ffmpeg/ffmpeg@0.10.1/dist/ffmpeg.min.js"></script>
  <script>
    const { createFFmpeg, fetchFile } = FFmpeg;
    const ffmpeg = createFFmpeg({ log: true });

    document.getElementById('start').addEventListener('click', async () => {
      const fileInput = document.getElementById('uploader');
      if (fileInput.files.length === 0) {
        alert("Pilih video dulu!");
        return;
      }

      const videoFile = fileInput.files[0];
      const fileName = "input.mp4";

      if (!ffmpeg.isLoaded()) {
        await ffmpeg.load();
      }

      ffmpeg.FS('writeFile', fileName, await fetchFile(videoFile));

      // Max 30 menit
      const maxDuration = 30 * 60; 
      const chunk = 30; 
      const totalClips = Math.ceil(maxDuration / chunk);

      for (let i = 0; i < totalClips; i++) {
        const start = i * chunk;
        const outName = `output_${i + 1}.mp4`;

        try {
          await ffmpeg.run(
            '-i', fileName,
            '-ss', String(start),
            '-t', String(chunk),
            '-c', 'copy',
            outName
          );

          const data = ffmpeg.FS('readFile', outName);
          const url = URL.createObjectURL(new Blob([data.buffer], { type: 'video/mp4' }));

          // Auto download
          const a = document.createElement('a');
          a.href = url;
          a.download = outName;
          a.click();

          // Tampilkan judul default
          const outDiv = document.getElementById('output');
          const p = document.createElement('p');
          p.textContent = `Vid ${i + 1} â€“ Judul default`;
          outDiv.appendChild(p);

        } catch (err) {
          console.error("Error clip:", err);
        }
      }
    });
  </script>
</body>
</html>
